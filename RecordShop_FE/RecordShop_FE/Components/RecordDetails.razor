@using RecordShop
@using Microsoft.Extensions.Logging
@rendermode InteractiveServer
@inject ILogger<RecordDetails> logger

<tr>
    @if (EditDetails) 
    {
        <RecordEditor Album="Album" OnUpdate="UpdateAlbum"/>
    }
    else 
    {
        <RecordSummary Album="Album" StatusCode="SyncStatus" OnEditRecord="ToggleFormVisible" />
    }
</tr>

@code {
    private RecordHttpRequests httpUtils = new RecordHttpRequests();

    [Parameter]
    public int SyncStatus { get; set; }

    public bool EditDetails { get; set; } = false;
    [Parameter] 
    public Album? Album { get; set; }

    [Parameter] 
    public EventCallback<Album> OnUpdateAlbum { get; set; }


    private void Submit()
    {
        logger.LogInformation(Album.ToString());
    }

    private void ToggleFormVisible(bool formVisible) => EditDetails = !formVisible;

    private void UpdateAlbum(Album album) {
        ToggleFormVisible(EditDetails);
        Album = album;
        SyncStatus = (int)httpUtils.UpdateRecord(album).StatusCode;
    }
}
